---
layout: page-documentation-md
title: Azion Preview Deployment
description: Azion Preview Deployment makes it possible for you to preview the behavior of your edge functions before they go to production.
meta_tags: edge, javascript
namespace: documentation_products_edge_functions_runtime_preview_deployment
permalink: /documentation/products/edge-application/edge-functions/runtime-api/preview-deployment/
permalink_pt-br: /documentacao/produtos/edge-application/edge-functions/runtime-api/preview-deployment/
---

# How to build an API with Edge Functions and ChatGPT

Learn about the required process to create an API with [Edge Functions]({% tl documentation_products_edge_functions %}) and [ChatGPT]({% tl documentation_products_edge_functions_runtime_ai_integration %}) and have the response shown on the [Azion Preview Deployment](documentation_products_edge_functions_runtime_preview_deployment).

To do so, you need to:

- Be registered [on ChatGPT](https://chat.openai.com/)
- Have [your ChatGPT API key]((https://platform.openai.com/account/api-keys)).
- Have [your ChatGPT organization ID](https://platform.openai.com/account/org-settings).

1. On [Real-Time Manager RTM](https://manager.azion.com/), on the upper-left corner, select **Edge Functions** in the **Edge Libraries** section. OK
2. Click on **Add a Function**. OK
3. Choose a name for your function. OK
4. Delete the placeholder function that is inside the code editor. OK 
5. Add your ChatGPT API key and organization ID to the code, as comment: OK

```javascript
    /*
    ChatGPTKey=sk-xxxxxxx
    ChatGPTOrg=org-xxxxxx
    */
```

>**Note**: the preview will present a warning mentioning the necessity of the `PreviewProvider` function. Don't worry, this situation will be covered by the coming steps.

5. Now, copy and paste the following const: OK

```javascript
    const html = `<!DOCTYPE html>
    <body>
      <h1>Hello World</h1>
      <p>This markup was generated by Azion - Edge Functions.</p>
    </body>`
```

6. Write the prompt that will generate the object we want to return. Inside the function, right below the ChatGPT credentials that were pasted on step 4: OK

```javascript
    // generate an object with 5 properties being 2 of them array of objects
```

7. Select the prompt, click it with the right button, and choose **ChatGPT: Generate** and wait a few seconds. OK

Expected output will be similar to:

```javascript
    let myObject = {
        property_1: 'value_1',
        property_2: 10,
        property_3: true,
        property_4: [{object_1: 'value_1'}, {object_2: 'value_2'}],
        property_5: [{object_3: 'value_3'}, {object_4: 'value_4'}]
    };
```

8. Add the `handleRequest` function, containing a `switch case`, with a `GET` and a `POST` method: OK

```javascript
async function handleRequest(request) {
  switch (request.method) {
    case 'POST':
      return new Response(JSON.stringify(myObject), { // Returning the object generated by ChatGPT
        headers: {
          "content-type": "application/json",// Altering the content-type to application/json
        }
      })
    case 'GET':
      return new Response(html, {
        headers: {
          "content-type": "text/html:charset=UTF-8",
        }
      })
  }
}
```

The `Post` method returns a `JSON` object, that was generated by the `ChatGPT: Generate` option.
The `GET` method returns the html const that was declared on step 4.

9. Now, copy and paste the `PreviewProvider` function, responsible for simulating requests: 

```javascript
    function PreviewProvider(args) {
      var request = {
        body: {},
        headers: {},
        method: "GET", 
        redirect: "",
      }
      return handleRequest(request)
    }
```

10. Add the `addEventListener` function, which triggers the whole processing of the edge function:

```javascript
    addEventListener("fetch", event => {
            return event.respondWith(handleRequest(event.request))
          })
```

11. Click with the right button anywhere inside the code editor and select **Format Document**

At this point, your edge function should look like this:

```javascript

    /*
    ChatGPTKey=sk-xxxxxxx
    ChatGPTOrg=org-xxxxxx
    */
    const html = `<!DOCTYPE html>
    <body>
      <h1>Hello World</h1>
      <p>This markup was generated by Azion - Edge Functions.</p>
    </body>`

    let myObject = {
            property_1: 'value_1',
            property_2: 10,
            property_3: true,
            property_4: [{object_1: 'value_1'}, {object_2: 'value_2'}],
            property_5: [{object_3: 'value_3'}, {object_4: 'value_4'}]
        };

    async function handleRequest(request) {
      switch (request.method) {
        case 'POST':
          return new Response(JSON.stringify(myObject), { // Returning the object generated by ChatGPT
            headers: {
              "content-type": "application/json",// Altering the content-type to application/json
            }
          })
        case 'GET':
          return new Response(html, {
            headers: {
              "content-type": "text/html:charset=UTF-8",
            }
          })
      }
    }

     function PreviewProvider(args) { 
      var request = {
        body: {},
        headers: {},
        method: "GET", //or POST
        redirect: "",
      }
      return handleRequest(request)
    }

      addEventListener("fetch", event => {
        return event.respondWith(handleRequest(event.request))
      })
```

Now, you can switch the method inside the `PreviewProvider` function and have a live preview of the responses on the [Azion Preview Deployment]({% tl %}).

11. Click the **Save** button.

Now, the function is ready to be instantiated in an edge application. Check how to [instantiate and execute the functions in your edge application]({% tl documentation_products_edge_applications_edge_functions_instances %}) and try it out.

---

## Related Documentation

- [Edge Functions Code Editor]({% tl documentation_products_edge_functions_runtime_code_editor %})
- [Edge Functions ChatGPT integration]({% tl documentation_products_edge_functions_runtime_ai_integration %})
- [Azion Preview Deployment]({% tl documentation_products_edge_functions_runtime_ai_integration %})
- [Edge Functions - JavaScript Runtime APIs]({% tl documentation_products_edge_functions_runtime_apis_javascript %})
- [Edge Functions]({% tl documentation_products_edge_functions %})
- [Edge Functions on Edge Firewall]({% tl documentation_products_edge_functions_firewall %})

---

Didnâ€™t find what you were looking for? [Open a support ticket](https://tickets.azion.com/).
